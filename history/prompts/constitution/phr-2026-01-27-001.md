---
title: Cartoonic Constitution Update - v2.3.1
stage: constitution
date: 2026-01-27
prompt_text: |-
  [analyze-mode]
  ANALYSIS MODE. Gather context before diving deep:

  CONTEXT GATHERING (parallel):
  - 1-2 explore agents (codebase patterns, implementations)
  - 1-2 librarian agents (if external library involved)
  - Direct tools: Grep, AST-grep, LSP for targeted searches

  IF COMPLEX (architecture, multi-system, debugging after 2+ failures):
  - Consult oracle for strategic guidance

  SYNTHESIZE findings before proceeding.

  ---
  
  ## User Input

  ```text
  `Write /sp.constitution.md for fixing a theme bug where the Cartoonic yellow background overrides the entire site.

  Musts:
  - Theme tokens must be scoped: each theme defines its CSS vars only under its selector (e.g., [data-theme="cartoonic"]).
  - No CSS vars for a theme should be placed in :root unless they are true neutral defaults.
  - The active theme must be applied via a single, consistent mechanism (data-theme on html/body or a single class).
  - Non-cartoonic themes must not inherit cartoonic --bg/--surface values.
  - No layout changes.
  - Accessibility: contrast remains readable.

  Must-nots:
  - Do not patch by hardcoding section backgrounds.
  - Do not duplicate tokens across multiple conflicting selectors.
  - Do not change component structure.
  ```

  You **MUST** consider the user input before proceeding (if not empty).

  ## Outline
  You are updating the project constitution at `.specify/memory/constitution.md`. This file is a TEMPLATE containing placeholder tokens in square brackets (e.g. `[PROJECT_NAME]`, `[PRINCIPLE_1_NAME]`). Your job is to (a) collect/derive concrete values, (b) fill the template precisely, and (c) propagate any amendments across dependent artifacts.
  
  ...
---
